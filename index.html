<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Previsão do Tempo - SMOeste</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: linear-gradient(135deg, #6ec1e4, #a8d5e2);
      color: #0d3b66;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 28px;
      margin-bottom: 20px;
      color: #0d3b66;
      text-shadow: 1px 1px 2px rgba(255,255,255,0.6);
    }
    .cards {
      display: flex;
      flex-wrap: wrap;
      justify-content: center;
      gap: 20px;
      margin-top: 20px;
    }
    .card {
       background: rgba(255, 255, 255, 0.25); /* fundo mais opaco para contraste */
  border: 1px solid rgba(255,255,255,0.2); /* leve borda para destacar */
  border-radius: 16px;
  padding: 15px;
  width: 230px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.15);
  backdrop-filter: blur(6px);
  transition: transform 0.2s;
  color: #ffffff;
    }
    .card:hover {
      transform: translateY(-5px);
    }
    .card h2 {
      margin: 5px 0 12px 0;
      font-size: 18px;
      border-bottom: 1px solid rgba(255,255,255,0.3);
      padding-bottom: 5px;
    }
    .horario {
      margin: 8px 0;
  padding: 6px 8px;
  background: rgba(150, 130, 250, 0.2); /* cor leve para destaque */
  border-radius: 10px;
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 14px;
  color: #ffffff;
  box-shadow: inset 0 1px 2px rgba(0,0,0,0.2);
    }
    .horario strong {
      display: inline-block;
      width: 50px;
    }
    .horario img {
      width: 24px;
      height: 24px;
    }
  </style>
</head>
<body>
  <h1>Previsão do Tempo - São Miguel do Oeste</h1>
  <div id="cards" class="cards"></div>

  <script>
    const backendUrl = "https://weather-backend-hh3w.onrender.com/forecast";
    const city = "São Miguel do Oeste";

    function capitalizeWords(str) {
      return str
    .split(' ') // separa por espaços
    .map(word => 
      word
        .split('-') // separa por hífen
        .map(part => part.charAt(0).toUpperCase() + part.slice(1)) // capitaliza cada parte
        .join('-') // junta as partes de volta com hífen
    )
    .join(' '); // junta as palavras de volta com espaço
    }

    async function carregarPrevisao() {
      try {
        const resp = await fetch(`${backendUrl}?city=${encodeURIComponent(city)}`);
        if (!resp.ok) throw new Error(`Erro HTTP: ${resp.status}`);
        const dados = await resp.json();
        if (!dados.list) throw new Error("Resposta inesperada do backend");

        const horarios = [6, 12, 18];
        const diasMap = new Map();

        // Agrupar previsões por dia
        dados.list.forEach(item => {
          const data = new Date(item.dt * 1000);
          const diaSemana = capitalizeWords(new Intl.DateTimeFormat("pt-BR", {
            timeZone: "America/Sao_Paulo",
            weekday: "long" // dia da semana por extenso
          }).format(data));
          const dataLocal = new Intl.DateTimeFormat("pt-BR", {
            timeZone: "America/Sao_Paulo",
            day: "2-digit",
            month: "2-digit",
            year: "numeric"
          }).format(data);

          const horaLocal = new Intl.DateTimeFormat("pt-BR", {
            timeZone: "America/Sao_Paulo",
            hour: "numeric",
            hour12: false
          }).format(data);

          if (horarios.includes(parseInt(horaLocal, 10))) {
            if (!diasMap.has(dataLocal)) diasMap.set(dataLocal, { diaSemana, horarios: [] });
            diasMap.get(dataLocal).horarios.push({
              hora: horaLocal,
              desc: item.weather[0].description,
              temp: Math.round(item.main.temp),
              icon: item.weather[0].icon
            });
          }
        });

        // Limitar a hoje + próximos 3 dias
        const diasOrdenados = Array.from(diasMap.keys()).slice(0, 4);

        const cardsDiv = document.getElementById("cards");
        cardsDiv.innerHTML = "";

        diasOrdenados.forEach(dia => {
          const previsoesDia = diasMap.get(dia).horarios;
          const diaSemana = diasMap.get(dia).diaSemana;
          const card = document.createElement("div");
          card.className = "card";

          card.innerHTML = `<h2>${diaSemana} - ${dia}</h2>` + previsoesDia.map(p => `
            <div class="horario">
              <strong>${p.hora}h</strong>
              <img src="https://openweathermap.org/img/wn/${p.icon}.png" alt="${p.desc}">
              ${capitalizeWords(p.desc)} | ${p.temp}°C
            </div>
          `).join("");

          cardsDiv.appendChild(card);
        });

      } catch (err) {
        console.error("Erro ao carregar previsão:", err);
        document.getElementById("cards").innerHTML = `<p>Não foi possível carregar a previsão.</p>`;
      }
    }

    carregarPrevisao();
  </script>
</body>
</html>
